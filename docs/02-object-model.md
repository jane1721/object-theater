# 📄 02 - 객체 중심 구조 리팩토링

> 📌 객체들에게 책임을 분산시키고, 캡슐화를 통해 `Theater.enter()`의 복잡도를 낮춘 구조로 리팩토링  
> 절차지향 구조에서 객체 협력 중심으로 전환하며 변경에 강하고 확장 가능한 시스템으로 개선한다.

---

## 목적

- **객체지향 원칙**을 적용하여 극장 예제 리팩토링
- 각 객체가 자신의 책임과 행위를 가지도록 변경
  - 책임에 따라 로직을 객체 내부로 이동
- 객체 간 **메시지**를 통한 협력 구현
  - `Theater → Audience → Bag → Ticket` 흐름으로 메시지를 전달
- → 더 높은 응집도와 낮은 결합도를 가지는 구조로 개선함

---

## 클래스 구성

```
objectmodel/
 ├── audience/
 │   ├── Audience.java        ← 입장 책임 받음
 │   └── Bag.java             ← 돈/티켓 검증 책임
 ├── ticket/
 │   ├── Invitation.java
 │   └── Ticket.java          ← 가격 정보 저장
 └── theater/
     ├── TicketOffice.java    ← 티켓 관리
     ├── TicketSeller.java    ← 티켓 팔림
     └── Theater.java         
```

| 클래스            | 설명                                                   |
|----------------|------------------------------------------------------|
| `Audience`     | `Bag` 을 통해 티켓을 구매하는 책임을 가짐. 입장 시 스스로 티켓을 구매하거나 보유함   |
| `Bag`          | 현금, 초대권, 티켓을 보유하며 티켓 구매 및 보관 행위를 스스로 수행              |
| `Invitation`   | 초대권 정보를 가진 단순 객체. 특정 시간 이전 초대 여부를 판단하는 로직을 추가할 수도 있음 |
| `Ticket`       | 티켓 가격 정보를 담는 단순한 값 객체                                |
| `TicketOffice` | 티켓 판매 및 금액 정산을 담당. `Ticket` 을 꺼내어 금액과 함께 관리          |
| `TicketSeller` | `TicketOffice` 를 통해 티켓을 판매하는 행위 주체                   |
| `Theater`      | 입장 책임을 가짐. `Audience` 와 `TicketSeller` 의 협력을 조율      |

---

## 리팩토링 핵심 포인트

- `Audience.buy(ticket)` 로 메시지 이동
- `Bag` 은 초대권 유무 판단 + 돈 차감/티켓 저장 책임
- `TicketOffice` 는 금액 처리 및 티켓 제공 책임
- `Theater` 는 단순히 관람객과 티켓오피스의 연결만 수행

---

## 개선점 요약

- **책임 분산**: 각 객체가 스스로 상태를 변경하고, 외부는 요청만 함
- **객체 협력 구조**: 메시지를 통해 다른 객체에 요청하며 동작
- **변경 용이성 향상**: 가격 정책 변경, 할인 로직 추가 시 특정 객체만 수정하면 됨
  - [02-1 - 객체 중심 구조에서의 변경 용이성](./02-changeability.md)
- **강한 캡슐화**: 내부 상태(amount, tickets 등)에 직접 접근하지 않고 메서드를 통해 조작
- **테스트 용이성**: 각 객체 단위로 테스트가 가능해지고, 시스템 테스트 부담 감소

---

## Commit List
- [♻️Refactor: 객체 중심 구조로 극장 입장 로직 리팩토링](https://github.com/jane1721/object-theater/commit/27105e2)
- [✅Test: 객체 중심 구조 기반 입장 테스트 작성](https://github.com/jane1721/object-theater/commit/b2dde91)